<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:comp="components.*"
	width="1024" height="768"
	layout="absolute"
	backgroundGradientColors="[#DCCEAF, #F1E0CC]"
	borderColor="#DC7B7B" backgroundGradientAlphas="[1.0, 1.0]"
	resize="{handleResize()}">
	
	<mx:Script>
		<![CDATA[
			import mx.events.ResizeEvent;
		
			public function handleResize():void {
				if(map != null && map.imageViewer != null && map.imageViewer.selected != null) {
					timelineHighlight.x = timeToSliderPosition(map.imageViewer.selected.timeStart);
					timelineHighlight.width = timeToSliderPosition(map.imageViewer.selected.timeEnd)-timelineHighlight.x;
				}
			}
		
			public function timeToSliderPosition(time:Number):Number {
				var pixelRange:Number = timeline.width - 10;
				var timeRange:Number = timeline.maximum - timeline.minimum;
				
				var timelineLoc:Number = timeline.x + 5 + (Math.abs(time-timeline.minimum)/timeRange)*pixelRange;
				return Math.min(timeline.x+pixelRange,Math.max(5,timelineLoc));
			}
			
		]]>
	</mx:Script>
	
	<mx:states>
		<mx:State name="searchResults">
			<mx:SetProperty target="{searchPanel}" name="visible" value="true"/>
			<mx:SetProperty target="{map.navControls}" name="x" value="250" />
			<mx:AddChild relativeTo="{searchPanel}" position="lastChild">
				<mx:Button x="0" y="10" label="Back" id="backButton" click="currentState=''"/>
			</mx:AddChild>
		</mx:State>
	</mx:states>
	
	<mx:transitions>
		<mx:Transition fromState="" toState="searchResults">
		</mx:Transition>
	</mx:transitions>
	
	<!-- 
		MAP
	-->
	<comp:FIG_PanZoom id="map" 
		backgroundColor="#8C7B6D" borderStyle="inset" themeColor="#335D77" cornerRadius="0" alpha="1.0" backgroundAlpha="1.0" right="10" top="10" left="233" bottom="118">
	</comp:FIG_PanZoom>
	
	<!--
		SEARCH RESULTS
	-->
	<mx:Panel id="searchPanel"
		width="250" height="637"
		layout="absolute"
		top="11" left="234"
		cornerRadius="0"
		backgroundColor="#CCC1A6"
		borderStyle="none"
		title="Search Results"
		mouseDownEffect="" visible="false">
	</mx:Panel>
	
	<!--
		TIMELINE
	-->
	<mx:Canvas height="73" id="timelineHighlight" backgroundColor="#B23F3F" backgroundAlpha="0.2" visible="{map.imageViewer.selected != null}" bottom="37">
	</mx:Canvas>
	<mx:Binding source="map.imageViewer.selected.label" destination="itemNameLabel.text" />
	<mx:Binding source="timeline.value" destination="map.imageViewer.time" />
	<mx:Binding source="timeToSliderPosition(map.imageViewer.selected.timeStart)" destination="timelineHighlight.x" />
	<mx:Binding source="timeToSliderPosition(map.imageViewer.selected.timeEnd)-timeToSliderPosition(map.imageViewer.selected.timeStart)" destination="timelineHighlight.width" />
	<mx:HSlider id="timeline"
		height="80"
		allowTrackClick="true" 
		liveDragging="true"
		snapInterval="1"
		tickLength="40"
		tickInterval="100"
		tickOffset="-10"
		labels="[1200,,1000,,800,,600,,400,,200,,0,,200,,400,500]"
		labelOffset="-50"
		minimum="-2000" maximum="500"
		value="0"
		change="{map.imageViewer.invalidateDisplayList()}" bottom="30" left="233" right="10">
	</mx:HSlider>
	
	<!--
		LAYER SELECTION PANE
	-->
	<mx:Binding source="culturalBorderCheckbox.selected" destination="map.imageViewer.showBorderCultural" />
	<mx:Binding source="politicalBorderCheckbox.selected" destination="map.imageViewer.showBorderPolitical" />
	<mx:Binding source="citiesPlacesCheckbox.selected" destination="map.imageViewer.showPlacesCities" />
	<mx:Binding source="battlePlacesCheckbox.selected" destination="map.imageViewer.showPlacesBattles" />
	<mx:Accordion x="10" width="215" height="190" backgroundAlpha="0.5" bottom="118">
		<mx:Canvas label="Borders" width="100%" height="100%" id="borderPane">
			<mx:VBox x="10" y="10" width="100%" height="100%" borderStyle="none">
				<mx:CheckBox label="Political" id="politicalBorderCheckbox" selected="true"/>
				<mx:CheckBox label="Cultural" id="culturalBorderCheckbox"/>
			</mx:VBox>
		</mx:Canvas>
		<mx:Canvas label="Places" width="100%" height="100%">
			<mx:VBox x="10" y="10" width="100%" height="100%">
				<mx:CheckBox label="Cities" id="citiesPlacesCheckbox"/>
				<mx:CheckBox label="Battles" id="battlePlacesCheckbox"/>
			</mx:VBox>
		</mx:Canvas>
	</mx:Accordion>
	
	<!--
		SEARCH FORM
	-->
	<mx:VBox x="10" y="10" width="215" height="130" verticalGap="4">
		<mx:Label text="Search"/>
		<mx:TextInput width="100%"/>
		<mx:CheckBox id="searchAdvancedCheckbox" label="Only search selected time period" />
		<mx:HBox id="searchAdvancedOptions"
			width="100%"
			visible="{searchAdvancedCheckbox.selected}"
			height="{searchAdvancedCheckbox.selected ? 25 : 0}"
			>
			<mx:TextInput width="33%"/>
			<mx:TextInput width="33%"/>
		</mx:HBox>
		<mx:Button label="Search" width="100%" click="currentState='searchResults'"/>
	</mx:VBox>
	
	<!--
		INFORMATION PANEL
	-->
	<mx:VBox x="10" y="148" width="214" height="302" verticalGap="4">
		<mx:Label text="Information" fontStyle="normal" fontWeight="bold"/>
		<mx:Canvas width="100%" height="100%" backgroundColor="#FFFFFF" backgroundAlpha="0.0" id="infoBox" visible="{itemNameLabel.text != ''}">
			<mx:VBox x="10" y="10" width="100%" height="100%" verticalGap="0">
				<mx:Label text="{map.imageViewer.selected.label}" id="itemNameLabel" fontSize="24" fontWeight="bold"/>
				<mx:Label text="{Math.abs(map.imageViewer.selected.timeStart)+'BC - '+Math.abs(map.imageViewer.selected.timeEnd)+'AD'}" id="itemTimeframeLabel" fontStyle="italic"/>
				<mx:Spacer height="20" width="100%"/>
				<mx:HBox width="100%">
					<mx:Label text="Population:" id="itemDataKey1" fontWeight="bold"/>
					<mx:Label text="123,456" id="itemDataValue1"/>
				</mx:HBox>
				<mx:HBox width="100%">
					<mx:Label text="Favorite food:" id="itemDataKey2" fontWeight="bold"/>
					<mx:Label text="Fish" id="itemDataValue2"/>
				</mx:HBox>
			</mx:VBox>
		</mx:Canvas>
	</mx:VBox>
	
</mx:WindowedApplication>
